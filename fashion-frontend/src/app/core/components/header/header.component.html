<!-- src/app/core/components/header/header.component.html -->
<header class="app-header-dark">
  <!-- Desktop Header -->
  <div class="header-container-desktop">
    <div class="header-left-desktop">
      <button class="icon-button-desktop hamburger-btn-desktop" (click)="onMenuClick()" aria-label="Open menu">
        <svg class="icon-svg icon-menu-svg" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" /></svg>
      </button>
      <a class="logo-desktop" [routerLink]="['/', currentLang]" aria-label="OBSCURITÉ Home">
        OBSCURITÉ
      </a>
    </div>
    <div class="header-right-desktop">
      <form class="search-form-desktop" (ngSubmit)="onDesktopSearch()">
        <button type="submit" class="search-icon-button" aria-label="Search">
          <svg class="icon-svg icon-search-svg" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5A6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" /></svg>
        </button>
        <input type="text" placeholder="SEARCH OBSCURITE.COM" [(ngModel)]="desktopSearchTerm" name="desktopSearchTerm" aria-label="Search site">
      </form>

      <!-- <<< FIX: Corrected routerLink for consistency >>> -->
      <a [routerLink]="['/', currentLang, 'account', 'wishlist']" class="icon-link wishlist-link-desktop" aria-label="Wishlist">
        <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" /></svg>
        @if (wishlistCount$ | async; as count) {
        @if (count > 0) {
        <span class="cart-item-count">{{ count > 9 ? '9+' : count }}</span>
        }
        }
      </a>

      <button (click)="onCartClick()" class="icon-link cart-link-desktop" aria-label="Shopping Cart">
        <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg"><circle cx="9" cy="21" r="1" /><circle cx="20" cy="21" r="1" /><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" /></svg>
        @if (itemCount$ | async; as count) {
        @if (count > 0) {
        <span class="cart-item-count">{{ count > 9 ? '9+' : count }}</span>
        }
        }
      </button>

      <div class="account-actions-desktop">
        @if (isLoggedIn && currentUser) {
        <a [routerLink]="['/', currentLang, 'account']" class="account-info-link" aria-label="My Account">
          <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg"><path d="M20 21v-2a4 4 0 0 0-3-3.87" /><path d="M4 21v-2a4 4 0 0 1 3-3.87" /><circle cx="12" cy="7" r="4" /></svg>
          <div class="account-text">
            <span class="greeting">HI, {{ currentUser.username?.toUpperCase() || 'USER' }}</span>
            <span class="main-account-link">MY ACCOUNT</span>
          </div>
        </a>
        } @else {
        <a [routerLink]="['/', currentLang, 'login']" class="icon-link login-link-desktop" aria-label="Sign In">
          <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg"><path d="M20 21v-2a4 4 0 0 0-3-3.87" /><path d="M4 21v-2a4 4 0 0 1 3-3.87" /><circle cx="12" cy="7" r="4" /></svg>
        </a>
        }
      </div>
    </div>
  </div>

  <!-- Mobile Header -->
  <div class="header-container-mobile">
    <div class="header-left-mobile">
      <button class="icon-button-mobile hamburger-btn-mobile" (click)="onMenuClick()" aria-label="Open menu">
        <svg class="icon-svg icon-menu-svg" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" /></svg>
      </button>
      <button class="icon-button-mobile search-btn-mobile" (click)="toggleMobileSearch()" aria-label="Open search">
        <svg class="icon-svg icon-search-svg" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5A6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" /></svg>
      </button>
    </div>

    <a class="logo-mobile" [routerLink]="['/', currentLang]" aria-label="OBSCURITÉ Home">
      OBSCURITÉ
    </a>

    <div class="header-right-mobile">
      <a [routerLink]="['/', currentLang, isLoggedIn ? 'account' : 'login']" class="icon-button-mobile account-link-mobile" aria-label="Account">
        <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg"><path d="M20 21v-2a4 4 0 0 0-3-3.87" /><path d="M4 21v-2a4 4 0 0 1 3-3.87" /><circle cx="12" cy="7" r="4" /></svg>
      </a>

      <!-- <<< FIX: Corrected routerLink for consistency >>> -->
      <a [routerLink]="['/', currentLang, 'account', 'wishlist']" class="icon-button-mobile wishlist-link-mobile" aria-label="Wishlist">
        <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" /></svg>
        @if (wishlistCount$ | async; as count) {
        @if (count > 0) {
        <span class="cart-item-count">{{ count > 9 ? '9+' : count }}</span>
        }
        }
      </a>

      <button (click)="onCartClick()" class="icon-button-mobile cart-link-mobile" aria-label="Shopping Cart">
        <svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg"><circle cx="9" cy="21" r="1" /><circle cx="20" cy="21" r="1" /><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" /></svg>
        @if (itemCount$ | async; as count) {
        @if (count > 0) {
        <span class="cart-item-count">{{ count > 9 ? '9+' : count }}</span>
        }
        }
      </button>
    </div>
  </div>

  @if (isMobileSearchActive) {
  <div class="mobile-search-overlay">
    <form class="mobile-search-form" (ngSubmit)="onMobileSearch()">
      <input type="text" placeholder="Search Obscurité..." [(ngModel)]="mobileSearchTerm" name="mobileSearchTerm" aria-label="Search site" autofocus>
      <button type="submit" class="search-submit-mobile" aria-label="Search">
        <svg class="icon-svg icon-search-svg" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5A6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" /></svg>
      </button>
      <button type="button" (click)="toggleMobileSearch()" class="close-search-mobile" aria-label="Close search">
        <svg class="icon-svg icon-close-svg" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z" /></svg>
      </button>
    </form>
  </div>
  }
</header>
